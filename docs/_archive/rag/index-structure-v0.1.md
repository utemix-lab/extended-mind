---
title: RAG Index Structure v0.1
version: 0.1
type: architecture
status: draft-core
tags: [rag, index, architecture]
lastmod: 2025-12-13
description: "Описание структуры индекса для RAG v0.1 и логики работы с ним."
---

# RAG Index Structure v0.1

---

## 1. Общий подход

В v0.1 extended-mind использует **один общий векторный индекс**, содержащий:

- структурированные знания,
- ADR,
- определения,
- паттерны,
- каркасы проектов.

Индекс должен быть:
- минимальным,
- быстрым,
- понятным,
- легко переносимым.

---

## 2. Структура индекса

Каждая запись в БД содержит:

### 2.1. Вектор
Эмбеддинг chunk_text:

"embedding": [...]

shell
Копировать код

### 2.2. Текст чанка

Полный текст блока, который модель может видеть:

"chunk_text": "..."

shell
Копировать код

### 2.3. Метаданные

{
"doc_id": "...",
"chunk_id": "...",
"type": "...",
"tags": [...],
"status": "...",
"source_path": "...",
"lastmod": "2025-01-01",
"chunk_index": 2
}

yaml
Копировать код

---

## 3. Логика фильтрации при retrieval

### 3.1. По типам

- definition → если вопрос: “что это?”
- adr → если вопрос: “почему так?”
- pattern → если вопрос: “как делать?”
- project → если вопрос касается V&P или других проектов
- concept-map → для структурных вопросов

### 3.2. По статусам

- включать: `accepted`, `draft-core`, `foundational`
- исключать: `draft-raw`, `private`

### 3.3. По темам (tags)

Например:

- `tag: story-layer`
- `tag: extended-mind`
- `tag: vp`
- `tag: architecture`

---

## 4. Режимы запроса

Индекс должен поддерживать два режима:

### 4.1. Fast mode (top-k 3–6)
Для коротких вопросов:
- определения,
- роли,
- очевидные связи.

### 4.2. Deep mode (top-k 10–20)
Для:
- архитектурных запросов,
- концептуальных вопросов,
- анализа story-layer.

---

## 5. Требования к консистентности

- один документ → один набор чанков,  
- пересборка индекса очищает старые записи,  
- невозможность существования “висячих” чанков.

---

## 6. Статус

Индекс v0.1 — основа для будущего перехода в:

- мультииндексы,
- индекс story-layer,
- графовое хранилище.
