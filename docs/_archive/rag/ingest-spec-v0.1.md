---
title: RAG Ingestion Specification v0.1
version: 0.1
type: spec
status: draft-core
tags: [rag, ingestion, specification]
lastmod: 2025-12-13
description: "Формальная спецификация процесса ingestion для extended-mind."
---

# RAG Ingestion Specification v0.1

Цель: определить **формальные правила**, по которым extended-mind превращает свои документы в векторный индекс.

---

## 1. Идентификаторы

### 1.1 Document ID
Формат:

doc:<relative-path>

makefile
Копировать код

Пример:

doc:docs/adr/adr-0003-rag-first.md

makefile
Копировать код

### 1.2 Chunk ID
Формат:

chunk:<doc-id>#<number>

makefile
Копировать код

Пример:

chunk:doc:docs/manifest/why-extended-mind.md#3

yaml
Копировать код

---

## 2. Метаданные чанков

Каждый чанк получает:

{
"doc_id": "...",
"chunk_id": "...",
"title": "...",
"type": "...",
"tags": [...],
"status": "...",
"lastmod": "...",
"source_path": "...",
"chunk_index": N
}

yaml
Копировать код

---

## 3. Предобработка текста

1. Извлечь frontmatter и сохранить его отдельно.  
2. Очистить тело документа:
   - убрать пустые строки >2,
   - нормализовать списки и заголовки,
   - но не переписывать структуру.

---

## 4. Правила чанкования

1. Разбить текст по заголовкам уровней `#`, `##`, `###`.
2. Каждый сегмент нарезается до размера:
   - `chunk_size` ± адаптивная поправка.
3. Между чанками создать overlap = `chunk_overlap`.

---

## 5. Последовательность ingestion

1. Прочитать config.yaml.  
2. Собрать список файлов.  
3. Отфильтровать по типам и статусу.  
4. Прочитать, распарсить, подготовить.  
5. Разбить на чанки.  
6. Создать эмбеддинги.  
7. Записать в векторную БД.  
8. Сохранить статистику (`index-info.json`).  

---

## 6. Валидация перед записью

- chunk_text не должен быть пустым,  
- document_id должен быть уникальным,  
- chunk_id должен быть уникальным,  
- метаданные должны быть валидным JSON,  
- embedding должен быть длины > 100.

---

## 7. Ошибки, не блокирующие ingestion

- отсутствует title → подставляется имя файла,  
- нет tags → подставляется пустой список,  
- нет lastmod → берётся timestamp файла.

---

## 8. Что должен вывести ingestion-скрипт

- количество документов,  
- количество чанков,  
- список включённых типов,  
- список исключённых файлов.

---

## 9. Статус

Документ применяется как формальная спецификация для v0.1 ingestion.
