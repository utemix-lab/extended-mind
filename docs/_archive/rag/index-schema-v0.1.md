---
title: RAG Index Schema v0.1
version: 0.1
type: spec
status: draft-core
tags: [rag, index, schema, retrieval]
lastmod: 2025-12-17
description: "Схема RAG-индекса extended-mind v0.1: какие сущности индексируются, с какими полями и по каким принципам."
---

# RAG Index Schema v0.1

Этот документ определяет **схему смыслового индекса extended-mind**  
(что именно попадает в RAG и в каком виде).

Он не описывает конкретную БД или API,  
а фиксирует **архитектурные принципы индексирования**.

---

## 1. Базовый принцип

> **Индекс — это не зеркало репозитория.  
> Индекс — это активное поле мышления.**

В индекс попадает **не всё**, что существует,  
а только то, что:

- имеет чёткий тип,
- несёт структурный смысл,
- может быть источником ответа.

---

## 2. Уровни сущностей в индексе

RAG v0.1 работает с тремя уровнями:

1. **Document-level** — файл как логическая единица  
2. **Chunk-level** — фрагмент текста (основная единица retrieval)  
3. **Metadata-level** — онтология, теги, контексты

---

## 3. Индексируемые типы (повтор для ясности)

В индекс v0.1 попадают только объекты следующих типов:

- `definition`
- `principle`
- `manifest`
- `adr`
- `pattern`
- `project` (только frame / intent)
- `concept-map`
- `spec`
- `core`

Все остальные типы **явно исключены** из индекса v0.1.

---

## 4. Схема document-level

Каждый индексируемый документ должен иметь:

```yaml
document_id: string        # уникальный идентификатор
path: string               # путь в репозитории
type: string               # object type
title: string
version: string
status: string
tags: [string]
contexts: [string]         # extended-mind, vova-and-petrova, evoquant, ...
description: string
Назначение document-level:

грубая фильтрация,

навигация,

приоритет источников.

5. Схема chunk-level (основная)
Каждый чанк — атом смысла для retrieval.

yaml
Копировать код
chunk_id: string
document_id: string
chunk_index: number
text: string               # основной текст чанка
section_title: string      # ближайший заголовок
type: string               # унаследован от документа
tags: [string]
contexts: [string]
priority: number           # логический приоритет (ADR > pattern > definition)
Комментарии:
text — то, что реально векторизуется

priority используется при конфликтных retrieval

contexts позволяют одному и тому же чанку жить в нескольких мирах

6. Приоритеты источников (для retrieval)
При равной близости эмбеддингов extended-mind должен учитывать приоритет:

Тип	Priority
adr	100
project	90
pattern	80
principle	70
definition	60
manifest	50
concept-map	40
spec/core	30

Это логический приоритет,
а не жёсткое правило ранжирования.

7. Контексты и проекты
Поле contexts решает ключевую задачу:

один и тот же тип объекта

может участвовать в разных проектах

без дублирования сущностей.

Пример:

yaml
Копировать код
contexts:
  - extended-mind
  - vova-and-petrova
  - thin-tank
Это позволяет:

фильтровать retrieval по проекту,

не дробить индекс на изолированные базы.

8. Что сознательно не индексируется (v0.1)
Следующие сущности исключены:

story-node

author-line

machine-log

сырые гипотезы

черновики без типа и intent

Причина:

Они не являются источниками истины,
а являются источниками материала.

9. Работа с сырыми проектами (evoquant, word-machine)
Для проектов с низкой зрелостью:

индексируется только:

project-frame

project-intent

project-scope

Не индексируется:

исследовательская “пена”,

философские потоки,

гипотезы без фиксации.

Это позволяет:

extended-mind знать о существовании проекта,

но не утонуть в его сыром содержимом.

10. Эволюция схемы
v0.1
один индекс

строгая фильтрация

ручная ingestion

v0.2 (опционально)
отдельный индекс для story-layer

ослабленные фильтры

экспериментальный retrieval

v0.3+
graph/GraphRAG

только при явных архитектурных триггерах (см. ADR)

11. Критерий завершённости схемы
Index Schema v0.1 считается достаточной, если:

Extended-mind может ответить:

“что это?”

“почему так?”

“как делать?”
без обращения к сырым данным.

Добавление нового проекта:

не требует изменения схемы,

требует только новых документов типа project.

12. Статус
Этот документ закрывает архитектурный этап RAG v0.1.

Дальнейшая работа extended-mind должна:

опираться на эту схему,

не расширять её без явной необходимости,

фиксировать любые изменения через ADR.
