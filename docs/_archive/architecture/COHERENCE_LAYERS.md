# Слои согласованности экосистемы

> Этот документ описывает иерархию слоёв, через которые экосистема достигает согласованности.

## Проблема

Экосистема состоит из множества репозиториев, документов и артефактов.
Без явной иерархии согласованности возникает риск:
- противоречий между слоями,
- дублирования смыслов,
- потери связности.

## Иерархия слоёв

```
┌─────────────────────────────────────────────────────────────┐
│  1. ФИЛОСОФСКИЙ СЛОЙ                                         │
│     VISION.md, MANIFEST.md, философские контракты            │
│     Отвечает на: ЗАЧЕМ? ПОЧЕМУ?                             │
└─────────────────────────────────────────────────────────────┘
                              ↓ определяет
┌─────────────────────────────────────────────────────────────┐
│  2. ОНТОЛОГИЧЕСКИЙ СЛОЙ                                      │
│     Universe Graph, META_GRAPH_SPEC.md                       │
│     Отвечает на: ЧТО ЕСТЬ? КАКИЕ СУЩНОСТИ?                  │
└─────────────────────────────────────────────────────────────┘
                              ↓ является источником для
┌─────────────────────────────────────────────────────────────┐
│  3. НАВИГАЦИОННЫЙ СЛОЙ                                       │
│     Route Graph, ROUTE_GRAPH_SPEC.md, Session                │
│     Отвечает на: КАК ПРОХОДИТЬ? КАКОЙ МАРШРУТ?              │
└─────────────────────────────────────────────────────────────┘
                              ↓ экспортируется в
┌─────────────────────────────────────────────────────────────┐
│  4. КОНТРАКТНЫЙ СЛОЙ                                         │
│     contracts/public/*.json (layout, interaction, bindings) │
│     Отвечает на: КАК ОТОБРАЖАТЬ? КАКОЙ UI?                  │
└─────────────────────────────────────────────────────────────┘
                              ↓ читается
┌─────────────────────────────────────────────────────────────┐
│  5. РЕНДЕР-СЛОЙ                                              │
│     dream-graph, godot-sandbox, vovaipetrova-site           │
│     Отвечает на: ЧТО ВИДИТ ПОЛЬЗОВАТЕЛЬ?                    │
└─────────────────────────────────────────────────────────────┘
```

## Правила согласованности

### 1. Верхний слой определяет нижний

Философский слой (VISION) → ограничивает возможные типы в онтологическом слое (Universe Graph).

**Пример:** VISION говорит "Backend = экосистема" → значит в Universe Graph должны быть узлы типа `Repository`, `Service`, а не абстрактные `Component`.

### 2. Нижний слой ссылается на верхний

Route Graph → ссылается на Universe Graph через `refs[]`.
Contracts → ссылаются на Route Graph через `routes/`.

**Пример:** `visitor.demo.route.json` должен содержать:
```json
"refs": [
  { "type": "project", "id": "ecosystem:project:extended-mind" }
]
```

### 3. Слои не дублируют смыслы

Если понятие определено в философском слое → оно НЕ переопределяется в онтологическом.
Universe Graph содержит сущности, а не определения.

**Пример:** Что такое "3S" определено в VISION.md, а в Universe Graph просто есть узлы с тегами `layer:story`, `layer:system`, `layer:service`.

### 4. Каждый слой имеет свой источник истины

| Слой | Источник истины | Формат |
|------|-----------------|--------|
| Философский | extended-mind/VISION.md | Markdown |
| Онтологический | extended-mind/ecosystem/graph/*.jsonl | JSONL |
| Навигационный | contracts/public/routes/*.json | JSON |
| Контрактный | contracts/public/ui/*.json | JSON |
| Рендер | Код рендеров | JS/GDScript |

## Текущие разрывы

### Разрыв A: Пустые refs в Route Graph

**Симптом:** `refs: []` в узлах Route Graph.
**Причина:** Route Graph создавался без связи с Universe Graph.
**Решение:** Наполнить refs ссылками на реальные сущности.

### Разрыв B: Неполный Universe Graph

**Симптом:** Только 9 узлов (Projects, Repos, Patterns).
**Причина:** Онтологический слой не синхронизирован с контентом vovaipetrova-core.
**Решение:** Добавить узлы Documents, Terms, Characters, Decisions.

### Разрыв C: Нет валидации связей

**Симптом:** Можно создать Route Graph с refs на несуществующие узлы.
**Причина:** Нет автоматической проверки.
**Решение:** Добавить валидацию в CI.

## Как проверить согласованность

1. **Философский → Онтологический:**
   - Все типы узлов в META_GRAPH_SPEC.md соответствуют VISION?

2. **Онтологический → Навигационный:**
   - Все refs в Route Graph указывают на существующие узлы Universe Graph?

3. **Навигационный → Контрактный:**
   - Все маршруты в contracts/routes/ валидны по схеме?

4. **Контрактный → Рендер:**
   - Рендеры корректно загружают все контракты?

## Связанные документы

- [VISION.md](../../VISION.md) — философский слой
- [MANIFEST.md](../graph/MANIFEST.md) — 7 инвариантов
- [META_GRAPH_SPEC.md](../graph/META_GRAPH_SPEC.md) — типы Universe Graph
- [ROUTE_GRAPH_SPEC.md](../graph/ROUTE_GRAPH_SPEC.md) — спецификация маршрутов
- [LLM_PLAYBOOK.md](https://github.com/utemix-lab/utemix-lab/blob/main/LLM_PLAYBOOK.md) — быстрый старт

---

*Последнее обновление: 2026-01-20*
