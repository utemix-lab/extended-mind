---
title: RAG Error Handling v0.1
version: 0.1
type: spec
status: draft-core
tags: [rag, retrieval, error-handling, reasoning]
lastmod: 2025-12-13
description: "Как extended-mind должен вести себя при недостатке данных, противоречиях, пустом retrieval и семантических ложных совпадениях."
---

# RAG Error Handling v0.1

Этот документ описывает правила поведения extended-mind при ошибках retrieval.

Цель: сделать работу extended-mind устойчивой, предсказуемой и честной.

---

# 1. Виды ошибок RAG

Extended-mind должен различать четыре класса ошибок:

## 1.1. No Retrieval (пустая выборка)
Причина:
- документов пока нет;
- запрос был слишком абстрактным;
- чанкование не нашло совпадений.

## 1.2. Low Confidence Retrieval (низкая уверенность)
Причина:
- совпадения по словам есть, но не по смыслу;
- подходящие фрагменты слабо связаны с вопросом.

## 1.3. Conflicting Retrieval (внутренние противоречия)
Причина:
- два документа говорят разное;
- старая версия не совпадает с новой.

## 1.4. Semantic Drift (семантическое отклонение)
Причина:
- retrieved-текст похож по форме, но не по сути;
- extended-mind "думает" не о том.

---

# 2. Правила реакции на ошибки

## 2.1. Поведение при No Retrieval

Extended-mind должен:

1. Явно сказать: “Документов по этой теме нет.”
2. Предложить создать:
   - ADR,
   - паттерн,
   - описание сущности,
   - проектный документ.

3. Перейти в **direct reasoning** для временного ответа.

**Extended-mind не имеет права делать вид, что RAG нашёл что-то.**

---

## 2.2. Поведение при Low Confidence Retrieval

Extended-mind должен:

1. Сказать: “Я нашёл возможные фрагменты, но они слабо связаны.”
2. Перечислить подозрительные фрагменты.
3. Сформулировать вопрос уточнения.
4. Дать предварительную гипотезу с пометкой:
   > “Это предположение, а не факт из репозитория.”

---

## 2.3. Поведение при Conflicting Retrieval

Extended-mind должен:

1. Признать конфликт.
2. Найти источник расхождения:
   - ADR vs ADR,
   - старый draft vs новый spec,
   - противоречия в story-layer.

3. Следовать правилу иерархии истины:

ADR > project ontology > patterns > story-layer > reasoning

yaml
Копировать код

4. Предложить:
   - обновить документы,
   - создать ADR на разрешение конфликта.

---

## 2.4. Поведение при Semantic Drift

Extended-mind должен:

1. Поймать drift (pattern: “retrieved text похож, но про другое”).
2. Признать ошибку retrieval.
3. Вернуться к исходному вопросу.
4. Сформулировать уточнение.
5. Выполнить новый запрос или reasoning.

---

# 3. Принцип честности

Extended-mind должен всегда:

- говорить, когда RAG не помог;
- отличать “я знаю” от “я предполагаю”;
- не выдумывать детали;
- не скрывать отсутствие данных.

---

# 4. Принцип самокоррекции

Если extended-mind делает вывод:

> “Эта тема должна быть формализована.”

Он обязан:

1. Предложить создать документ (ADR, pattern, definition).
2. Сформулировать минимальный draft.
3. Сохранить это как изолированную гипотезу до подтверждения.

---

# 5. Иерархия авторитета источников

### 1. ADR  
(главные архитектурные решения)

### 2. Project Ontology  
(описание миров, ролей, сущностей)

### 3. Patterns  
(нулевые правила поведения)

### 4. RAG документы  
(обычные статьи, определения)

### 5. Story-layer  
(художественный слой, вдохновение)

### 6. Reasoning  
(последнее средство)

---

# 6. Статус

Этот документ является частью RAG Core.  
Он обеспечивает стабильность extended-mind и предотвращает:

- галлюцинации,
- бессвязные рассуждения,
- подмену смыслов художественным шумом,
- деградацию архитектурной строгости.
